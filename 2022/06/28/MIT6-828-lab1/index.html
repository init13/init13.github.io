<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    
    <title>MIT6.828-lab1 | init13&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="MIT6.828">
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css" />
    <link rel="stylesheet" href="/css/style.css?v=1.4.4">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	false,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpeg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">init13</h5>
          <a href="mailto:(＠￣ー￣＠)" title="(＠￣ー￣＠)" class="mail">
            
              <span>(</span>
            
              <span>＠</span>
            
              <span>￣</span>
            
              <span>ー</span>
            
              <span>￣</span>
            
              <span>＠</span>
            
              <span>)</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/init13" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>MIT6.828-lab1</span>
            
        </div>
        
        <a id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpeg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">MIT6.828-lab1</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-06-28T04:00:00.000Z" itemprop="datePublished" class="page-time">
  2022-06-28
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MIT6-828/">MIT6.828</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>



<div class="container body-wrap">
    <article id="post-MIT6-828-lab1"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">MIT6.828-lab1</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-06-28 00:00:00" datetime="2022-06-28T04:00:00.000Z"  itemprop="datePublished">2022-06-28</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MIT6-828/">MIT6.828</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h1 id="lec01"><a href="#lec01" class="headerlink" title="lec01"></a>lec01</h1><p>原链接：<a href="https://pdos.csail.mit.edu/6.828/2021/tools.html" target="_blank" rel="noopener">https://pdos.csail.mit.edu/6.828/2021/tools.html</a></p>
<p>教程链接：<a href="https://mit-public-courses-cn-translatio.gitbook.io/mit6-s081/lec01-introduction-and-examples/1.2-cao-zuo-xi-tong-jie-gou" target="_blank" rel="noopener">https://mit-public-courses-cn-translatio.gitbook.io/mit6-s081/lec01-introduction-and-examples/1.2-cao-zuo-xi-tong-jie-gou</a></p>
<h2 id="课程总结："><a href="#课程总结：" class="headerlink" title="课程总结："></a>课程总结：</h2><blockquote>
<p>实际上RISC-V还有第三种模式称为machine mode。在大多数场景下，我们会忽略这种模式，所以我也不太会介绍这种模式。 所以实际上我们有三级权限（user/kernel/machine），而不是两级(user/kernel)。<br>简单来说这一张主要讲的是一些系统调用相关的知识，看的我想回去学pwn了。。。</p>
</blockquote>
<h3 id="操作系统内核态与用户态的转换。"><a href="#操作系统内核态与用户态的转换。" class="headerlink" title="操作系统内核态与用户态的转换。"></a>操作系统内核态与用户态的转换。</h3><p><strong>内核态</strong>：完成一些底层的硬件交互，为应用程序提供抽象的high-level可移植接口。但是，提供一个简单可移植，同时又高效的抽象接口需要一定的技巧。</p>
<p><strong>用户态</strong>：与Kernel中的文件系统交互，文件系统再与磁盘交互，来实现各种功能。</p>
<blockquote>
<p>每一个用户空间程序都被称为一个进程，它们有自己的内存和共享的CPU时间。同时，Kernel会管理内存的分配。不同的进程需要不同数量的内存，Kernel会复用内存、划分内存，并为所有的进程分配内存。</p>
</blockquote>
<h3 id="有关exec系统调用，有一些重要的事情："><a href="#有关exec系统调用，有一些重要的事情：" class="headerlink" title="有关exec系统调用，有一些重要的事情："></a>有关exec系统调用，有一些重要的事情：</h3><ol>
<li>exec系统调用会保留当前的文件描述符表单。所以任何在exec系统调用之前的文件描述符，例如0，1，2等。它们在新的程序中表示相同的东西。</li>
<li>通常来说exec系统调用不会返回，因为exec会完全替换当前进程的内存，相当于当前进程不复存在了，所以exec系统调用已经没有地方能返回了（ps: 写时复制，好像脏牛和这个有关，有时间再去看看）</li>
</ol>
<blockquote>
<p>所以，exec系统调用从文件中读取指令，执行这些指令，然后就没有然后了。exec系统调用只会当出错时才会返回，因为某些错误会阻止操作系统为你运行文件中的指令，例如程序文件根本不存在，因为exec系统调用不能找到文件，exec会返回-1来表示：出错了，我找不到文件。所以通常来说exec系统调用不会返回，它只会在kernel不能运行相应的文件时返回。<br>ps：这里应该指的是调用exec的时候出错，而不是调用的程序执行时报错，因为那个时候当前进程应该已经不存在了。</p>
</blockquote>
<h2 id="lab1"><a href="#lab1" class="headerlink" title="lab1:"></a>lab1:</h2><h3 id="SLEEP："><a href="#SLEEP：" class="headerlink" title="SLEEP："></a>SLEEP：</h3><p>简单的系统调用，不知道为啥sleep函数的入参不是秒为单位，但是也不像微秒或者毫秒。。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"user/user.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="number">2</span>, <span class="string">"usage: sleep [time second]\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> time = atoi(argv[<span class="number">1</span>]);<span class="comment">// 如果没有执行有效的转换，则返回0;</span></span><br><span class="line">    sleep(time);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="pingpong"><a href="#pingpong" class="headerlink" title="pingpong:"></a>pingpong:</h3><p>Fork 函数返回子进程id，由于被fork出来的进程没有子进程所以为0，用这个区分父进程与子进程，并且fork会把已有的文件描述符保留，如果文件描述符已经关闭了则不保留。</p>
<p>如果管道为空，而且管道的输入口至少有一个进程打开着，那么一个进程试图读取管道的时将会被挂起，直到有数据为止，这也可以保证不同进程之间的同步性，具体可以看下一个实验的例子。</p>
<blockquote>
<ol>
<li>如果所有指向管道写端的文件描述符都关闭了（管道写端的引用计数等于0）， 而仍然有进程从管道的读端读数据，那么管道中剩余的数据都被读取后， 再次 read 会返回0，就像读到文件末尾一样。</li>
<li>如果有指向管道写端的文件描述符没关闭（管道写端的引用计数大于0），而持有管道写端的进程也没有向管道中写数据，这时有进程从管道读端读数据， 那么管道中剩余的数据都被读取后，再次 read 会阻塞， 直到管道中有数据可读了才读取数据并返回。</li>
<li>如果所有指向管道读端的文件描述符都关闭了，而仍然有进程从管道的写端写数据，那么write会返回-1。</li>
<li>如果同时读取管道会随机分配给其中一个读<br>参考：<a href="https://www.jianshu.com/p/350dc21fe5e3" target="_blank" rel="noopener">https://www.jianshu.com/p/350dc21fe5e3</a></li>
</ol>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"user/user.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> ping[] = <span class="string">"ping"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> pong[] = <span class="string">"pong"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pid, pip[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">char</span> recv[<span class="number">20</span>];</span><br><span class="line">    <span class="comment">//int recv;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建pipe</span></span><br><span class="line">    <span class="comment">// fd[0]是管道读取端的fd(文件描述符), fd[1]是管道写入端的fd</span></span><br><span class="line">    <span class="comment">// 成功时返回：0, 错误时为-1</span></span><br><span class="line">    <span class="keyword">if</span> (pipe(pip) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create pip failed!!!"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof recv: %d \n"</span>, <span class="keyword">sizeof</span>(recv));</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">close</span>(pip[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">int</span> cpid = fork();</span><br><span class="line">        <span class="keyword">if</span> (cpid == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="comment">//            close(pip[1]);</span></span><br><span class="line">            <span class="built_in">read</span>(pip[<span class="number">0</span>], recv, <span class="keyword">sizeof</span>(recv));</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"grand child pid=%d: received %s\n"</span>,getpid(), recv);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">read</span>(pip[<span class="number">0</span>], recv, <span class="keyword">sizeof</span>(recv));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"child pid=%d: received %s\n"</span>,getpid(), recv);</span><br><span class="line"><span class="comment">//            write(pip[1], pong, sizeof(pong));</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        sleep(10);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        close(pip[1]);</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">write</span>(pip[<span class="number">1</span>], ping, <span class="keyword">sizeof</span>(ping));</span><br><span class="line">        <span class="built_in">close</span>(pip[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">read</span>(pip[<span class="number">0</span>], recv, <span class="keyword">sizeof</span>(recv));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"parent pid=%d: received %s\n"</span>,getpid(), recv);</span><br><span class="line">        <span class="keyword">int</span> test;</span><br><span class="line">        wait(&amp;test);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Prime"><a href="#Prime" class="headerlink" title="Prime:"></a>Prime:</h3><p>这题有点意思，通过管道的方式来实现素数的生成。原理很简单，每一个大于1的整数n都能分解成质因数的乘积。本题的思路就是用下图的模型打印2～35之间的素数：</p>
<figure class="image-box">
                <a rel=MIT6.828-lab1 href="https://swtch.com/~rsc/thread/sieve.gif" target="_blank" title="图片" data-fancybox="images"><img src="https://swtch.com/~rsc/thread/sieve.gif" alt="图片" title="" class=""></a>
                <p>图片</p>
            </figure>

<p>首先主进程负责产生2～35之间的整数，子进程记录一个素数，并与之后传过来的数进行取余，如果不能整除就交给下一个子进程，用pipe实现起来感觉像链表。这题需要注意关掉多余的pip不然进程永远无法退出。。。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"user/user.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pid, pip[<span class="number">2</span>];</span><br><span class="line">    <span class="comment">// 在fork之前生成管道</span></span><br><span class="line">    <span class="keyword">if</span> (pipe(pip)&lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create pip failed!!"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//父进程关闭读接口，并产生数字，向管道传递 </span></span><br><span class="line">        <span class="built_in">close</span>(pip[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num = <span class="number">2</span>; num &lt;= <span class="number">35</span>; num ++)&#123;</span><br><span class="line">            <span class="built_in">write</span>(pip[<span class="number">1</span>], (<span class="keyword">char</span> *)&amp;num, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//子进程关掉父进程的写接口</span></span><br><span class="line">        <span class="built_in">close</span>(pip[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">int</span> prime = <span class="number">0</span>, newNum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span> recvNum[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">read</span>(pip[<span class="number">0</span>], recvNum, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)))&#123;</span><br><span class="line">            newNum = *(<span class="keyword">int</span> *)recvNum;</span><br><span class="line">            <span class="comment">//创建管道，生成子进程，并初始化prime</span></span><br><span class="line">            <span class="keyword">if</span> (prime == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">int</span> pipTemp[<span class="number">2</span>];</span><br><span class="line">                <span class="keyword">if</span> (pipe(pipTemp)&lt; <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"create pip failed!!"</span>);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">int</span> ppid = fork();</span><br><span class="line">                <span class="keyword">if</span> (ppid == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// 子进程关掉父进程继承下来的读借口，以及新的写接口</span></span><br><span class="line">                    <span class="built_in">close</span>(pip[<span class="number">0</span>]);</span><br><span class="line">                    <span class="built_in">close</span>(pipTemp[<span class="number">1</span>]);</span><br><span class="line">                    pip[<span class="number">0</span>] = pipTemp[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 父进程关掉新的读接口</span></span><br><span class="line">                <span class="built_in">close</span>(pipTemp[<span class="number">0</span>]);</span><br><span class="line">                pip[<span class="number">1</span>] = pipTemp[<span class="number">1</span>];</span><br><span class="line">                prime = newNum;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"child pid = %d, prime = %d \n"</span>, getpid(), prime);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// 判断是否能被整除，不能整除说明有可能是素数，并发送至下一个进程</span></span><br><span class="line">                <span class="keyword">if</span> (newNum % prime != <span class="number">0</span> )&#123;</span><br><span class="line">                    <span class="built_in">write</span>(pip[<span class="number">1</span>], (<span class="keyword">char</span> *) &amp;newNum, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(pip[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">int</span> status;</span><br><span class="line">    wait(&amp;status);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"pid[%d] says: the end \n"</span>, getpid());</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><p>这题主要是通过学习ls的源码，写一个类似的文件信息读写。主要是了解Linux中与文件状态相关的结构体有两个dirent与stat，这两个结构体在xv6操作系统中进行了简化。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T_DIR     1   <span class="comment">// Directory</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T_FILE    2   <span class="comment">// File</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T_DEVICE  3   <span class="comment">// Device</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stat</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> dev;     <span class="comment">// File system's disk device</span></span><br><span class="line">  uint ino;    <span class="comment">// Inode number</span></span><br><span class="line">  short type;  <span class="comment">// Type of file</span></span><br><span class="line">  short nlink; <span class="comment">// Number of links to file</span></span><br><span class="line">  uint64 <span class="built_in">size</span>; <span class="comment">// Size of file in bytes</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> &#123;</span></span><br><span class="line">  ushort inum;  </span><br><span class="line">  <span class="keyword">char</span> name[DIRSIZ]; <span class="comment">// 文件名 #define DIRSIZ 14</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>stat存放文件信息，目录为特殊的文件，其type为T_DIR，文件内容是一个特殊的dirent结构体<strong>数组</strong>，其结构为stat。通过读取stat结构信息获取目录下的文件信息。没啥坑点，就是需要注意文件名的长度。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">      </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"user/user.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/fs.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find</span><span class="params">(<span class="keyword">char</span> *path, <span class="keyword">char</span> *filename)</span></span>&#123;</span><br><span class="line"><span class="comment">//    char buf[512];</span></span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">st</span>;</span> <span class="comment">// stat 用于表示文件的状态和类型，在mit的操作系统中的格式较为简单，但是竟然不存文件路径。。</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> <span class="title">de</span>;</span> <span class="comment">// dirent 表示目录中的文件信息，目录文件就是一个dirent列表</span></span><br><span class="line">    <span class="keyword">char</span> fullPath[<span class="number">512</span>], *p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((fd = <span class="built_in">open</span>(path, <span class="number">0</span>)) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="number">2</span>, <span class="string">"find: cannot open %s\n"</span>, path); <span class="comment">//错误输出</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取文件信息</span></span><br><span class="line">    <span class="keyword">if</span> (fstat(fd, &amp;st) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="number">2</span>, <span class="string">"find: cannot get stat %s\n"</span>, path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果当前文件不是目录，则不搜索了，否则深度优先搜索当前目录及其子目录。</span></span><br><span class="line">    <span class="keyword">switch</span> (st.type) &#123;</span><br><span class="line">        <span class="comment">// 如果是文件则判断是否相等</span></span><br><span class="line">        <span class="keyword">case</span> T_FILE:</span><br><span class="line">        <span class="comment">// 如果find的directory文件类型是文件，不用判断的吧。。</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> T_DIR:</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strlen</span>(path) + <span class="number">1</span> + DIRSIZ + <span class="number">1</span> &gt; <span class="keyword">sizeof</span>(fullPath))&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"ls: path too long\n"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// size上面判断过了应该不会溢出</span></span><br><span class="line">            <span class="built_in">strcpy</span>(fullPath, path);</span><br><span class="line">            p = fullPath + <span class="built_in">strlen</span>(fullPath);</span><br><span class="line">            *p++ = <span class="string">'/'</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="built_in">read</span>(fd, &amp;de, <span class="keyword">sizeof</span>(de)) == <span class="keyword">sizeof</span>(de))&#123;</span><br><span class="line"><span class="comment">//                printf("path = %s | %s\n", de.name, fullPath);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (de.inum == <span class="number">0</span> || <span class="built_in">strcmp</span>(de.name, <span class="string">".."</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(de.name, <span class="string">"."</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                memmove(p, de.name, DIRSIZ);<span class="comment">// DIRSIZ定义在结构体dirent中</span></span><br><span class="line">                p[DIRSIZ] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//                printf("--------- path = %s \n", fullPath);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(de.name, filename) == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"%s \n"</span>, fullPath);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (stat(fullPath, &amp;st) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"find: cannot stat %s\n"</span>, fullPath);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (st.type == T_DIR)&#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"path %s is dir, dive in\n"</span>, fullPath);</span><br><span class="line">                    <span class="built_in">find</span>(fullPath, filename);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="number">2</span>, <span class="string">"unknown file type: %d\n"</span>, st.type);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (argc &lt; <span class="number">3</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Usage: %s [directory] [filename]\n"</span>,argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;argc;i++)</span><br><span class="line">		<span class="built_in">find</span>(argv[<span class="number">1</span>], argv[i]);</span><br><span class="line">	<span class="built_in">exit</span> (<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="xargs"><a href="#xargs" class="headerlink" title="xargs:"></a>xargs:</h3><p>本题主要考察exec系统调用，由于shell实现了重定向，因此这里只需要从标准输入获取参数即可，这里主要就是处理args参数的问题。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"user/user.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/fs.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"kernel/param.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> getchar(ch) read(0, ch, sizeof(char))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> min(a, b) ((a) &lt; (b) ? (a) : (b))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARGLEN 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 本地存放参数的空间</span></span><br><span class="line"><span class="keyword">char</span> args[MAXARG+<span class="number">1</span>][ARGLEN];</span><br><span class="line"><span class="keyword">char</span> *commandArgs[MAXARG];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getchr</span><span class="params">(<span class="keyword">char</span> *ch)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">read</span>(<span class="number">0</span>, ch, <span class="keyword">sizeof</span> (<span class="keyword">char</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从标准输入获取参数, 一个字符一个字符读取效率是个问题，可以考虑grep.c中的方法</span></span><br><span class="line"><span class="comment">// 但是，该方法存在一个问题，如果没有换行符，或者字符串长度超过1023会直接退出。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">xargs</span><span class="params">(<span class="keyword">char</span> *command, <span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> nowArg = <span class="number">0</span>, len = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 全局变量始化就是0，故不考虑最后一个字符截断的问题</span></span><br><span class="line">    <span class="keyword">while</span>( getchr(args[nowArg] + len) )&#123;</span><br><span class="line"><span class="comment">//        printf("%d %d \n", nowArg, len);</span></span><br><span class="line">        <span class="keyword">switch</span> ( args[nowArg][len] ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">' '</span>:</span><br><span class="line">                <span class="keyword">if</span> (len == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 截断字符串</span></span><br><span class="line">                    args[nowArg][len]=<span class="string">'\0'</span>;</span><br><span class="line">                    commandArgs[nowArg + argc] = args[nowArg];</span><br><span class="line">                    nowArg ++, len = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'\n'</span>:</span><br><span class="line">                <span class="comment">// fork 进程并执行</span></span><br><span class="line">                args[nowArg][len] = <span class="string">'\0'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//                printf("exec: [%s] args: ", command );</span></span><br><span class="line"><span class="comment">//                for (int i = 0;i &lt; nowArg + argc;i++)&#123;</span></span><br><span class="line"><span class="comment">//                    printf("[%s] ", commandArgs[i]);</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//                printf("\n");</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> pid = fork();</span><br><span class="line">                <span class="keyword">if</span> (pid == <span class="number">0</span>)&#123;</span><br><span class="line">                    exec(command, commandArgs);</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"exec failed !!"</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (pid &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"fork error !!"</span>);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                wait(<span class="number">0</span>);</span><br><span class="line">                nowArg = <span class="number">0</span>, len = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                len ++ ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (nowArg + <span class="number">1</span> + argc &gt; MAXARG || len &gt;= ARGLEN - <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="number">2</span>, <span class="string">"too many args %d %d\n"</span>,nowArg + argc, len);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    int</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>)&#123;</span><br><span class="line"><span class="comment">//        for (int i=0;i&lt;1022;i++) printf("a");</span></span><br><span class="line"><span class="comment">//        printf("\n");</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Usage: %s command [args]\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不确定argv的长度，只能拷贝到本地存放， 且不能超过MAXARG，不要忘记第一</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>,j = <span class="number">0</span>; i &lt; <span class="built_in">min</span>(argc, MAXARG); i++, j++)&#123;</span><br><span class="line">        commandArgs[j] = argv[i];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    printf ("%s\n", commandArgs[0]);</span></span><br><span class="line"><span class="comment">//    printf ("%d\n", argc - 2);</span></span><br><span class="line">    xargs(argv[<span class="number">1</span>], argc - <span class="number">1</span>, argv + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2022-06-27T17:31:10.150Z" itemprop="dateUpdated">2022-06-27 13:31:10</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2022/06/28/MIT6-828-lab1/" target="_blank" rel="external">http://init13.github.io/2022/06/28/MIT6-828-lab1/</a>
        
    </div>
    <footer>
        <a href="http://init13.github.io">
            <img src="/img/avatar.jpg" alt="init13">
            init13
        </a>
    </footer>
</blockquote>

        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MIT6-828/" rel="tag">MIT6.828</a></li></ul>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="next">
      <a href="/2021/05/07/mail-spoofing/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">mail_spoofing</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#lec01"><span class="post-toc-number">1.</span> <span class="post-toc-text">lec01</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#课程总结："><span class="post-toc-number">1.1.</span> <span class="post-toc-text">课程总结：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#操作系统内核态与用户态的转换。"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">操作系统内核态与用户态的转换。</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#有关exec系统调用，有一些重要的事情："><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">有关exec系统调用，有一些重要的事情：</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#lab1"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">lab1:</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SLEEP："><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">SLEEP：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#pingpong"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">pingpong:</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Prime"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">Prime:</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#find"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">find</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#xargs"><span class="post-toc-number">1.2.5.</span> <span class="post-toc-text">xargs:</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://www.github.com" target="_blank">github</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                init13 &copy; 2017 - 2022
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.4"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.4"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.4"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>




    <script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '(o>ェ<)';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>





    
</body>
</html>
